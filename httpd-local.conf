ServerTokens OS
ServerRoot /static-html
Listen 10000

ServerLimit 2048
MaxRequestWorkers 2048

LoadModule mpm_prefork_module /usr/lib/apache2/mod_mpm_prefork.so
LoadModule authn_file_module /usr/lib/apache2/mod_authn_file.so
LoadModule authn_core_module /usr/lib/apache2/mod_authn_core.so
LoadModule authz_host_module /usr/lib/apache2/mod_authz_host.so
LoadModule authz_groupfile_module /usr/lib/apache2/mod_authz_groupfile.so
LoadModule authz_user_module /usr/lib/apache2/mod_authz_user.so
LoadModule authz_core_module /usr/lib/apache2/mod_authz_core.so
LoadModule access_compat_module /usr/lib/apache2/mod_access_compat.so
LoadModule auth_basic_module /usr/lib/apache2/mod_auth_basic.so
LoadModule reqtimeout_module /usr/lib/apache2/mod_reqtimeout.so
LoadModule filter_module /usr/lib/apache2/mod_filter.so
LoadModule substitute_module /usr/lib/apache2/mod_substitute.so
LoadModule mime_module /usr/lib/apache2/mod_mime.so
LoadModule log_config_module /usr/lib/apache2/mod_log_config.so
LoadModule env_module /usr/lib/apache2/mod_env.so
LoadModule headers_module /usr/lib/apache2/mod_headers.so
LoadModule setenvif_module /usr/lib/apache2/mod_setenvif.so
LoadModule version_module /usr/lib/apache2/mod_version.so
LoadModule unixd_module /usr/lib/apache2/mod_unixd.so
LoadModule status_module /usr/lib/apache2/mod_status.so
LoadModule autoindex_module /usr/lib/apache2/mod_autoindex.so
LoadModule dir_module /usr/lib/apache2/mod_dir.so
# LoadModule alias_module /usr/lib/apache2/mod_alias.so
LoadModule rewrite_module /usr/lib/apache2/mod_rewrite.so

LoadModule negotiation_module /usr/lib/apache2/mod_negotiation.so

LoadModule proxy_module /usr/lib/apache2/mod_proxy.so
LoadModule proxy_http_module /usr/lib/apache2/mod_proxy_http.so
# LoadModule proxy_http2_module /usr/lib/apache2/mod_proxy_http2.so

ServerName localhost
ServerSignature Off

<Directory />
     AllowOverride none
     Require all denied
</Directory>

DocumentRoot "/static-html/htdocs"

<IfModule dir_module>
     DirectoryIndex index.html
</IfModule>

<Files ".ht*">
     Require all denied
</Files>

ErrorLog /dev/stdout
ErrorLogFormat "%{cu}t WARN function: [%-m:%l] process: [pid %P:tid %T] message: %M"
LogLevel warn
LogFormat "%{%T}t.%{usec_frac}t INFO %m %U%q %>s" plain
CustomLog /dev/stdout plain

<IfModule mime_module>
    TypesConfig /etc/apache2/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
</IfModule>

<VirtualHost *:10000>
        ServerName localhost
        DocumentRoot /static-html/reg-frontend

        # Header always set Content-Security-Policy "default-src 'self' 'unsafe-inline'; img-src 'self' data: ; font-src 'self' data: ;"

        <Directory /static-html/reg-frontend>
            Require all granted
            Options FollowSymLinks MultiViews
        </Directory>

		# intentionally not blocking admin api requests for local dev

        ProxyRequests Off
        <Proxy *>
            Order deny,allow
            Allow from all
        </Proxy>

		# regsys classic
		ProxyPass /regsys http://localhost:8080
		ProxyPassReverse /regsys http://localhost:8080

		# reg-auth-service
		ProxyPass /authsrv/ http://localhost:4712/
		ProxyPassReverse /authsrv/ http://localhost:4712/

		# reg-attendee-service
		ProxyPass /attsrv/ http://localhost:9091/
		ProxyPassReverse /attsrv/ http://localhost:9091/

		# reg-payment-service
		ProxyPass /paysrv/ http://localhost:9092/
		ProxyPassReverse /paysrv/ http://localhost:9092/

		# reg-mail-service
		ProxyPass /mailsrv/ http://localhost:9093/
		ProxyPassReverse /mailsrv/ http://localhost:9093/

		# reg-room-service
		ProxyPass /roomsrv/ http://localhost:9094/
		ProxyPassReverse /roomsrv/ http://localhost:9094/

		# reg-export-service (does not exist yet)
		ProxyPass /expsrv/ http://localhost:9095/
		ProxyPassReverse /expsrv/ http://localhost:9095/

		# reg-config-service (does not exist yet)
		ProxyPass /confsrv/ http://localhost:9096/
		ProxyPassReverse /confsrv/ http://localhost:9096/

		# reg-paygate-adapter
		ProxyPass /paygatesrv/ http://localhost:9097/
		ProxyPassReverse /paygatesrv/ http://localhost:9097/

		# proxy to onsite UIs (nav page) (port conflicts with reg-frontend)
        # ProxyPass /onsite http://localhost:8000/onsite disablereuse=On connectiontimeout=20 timeout=60
        # ProxyPassReverse /onsite http://onsite:8000/onsite

        # configuration for reg-frontend

        # RewriteEngine on

        # special rules to prevent deep reloads and base link without trailing /
        # RewriteRule "^/app/register/[a-z-]+/.*$" "/app/register/index.html"
        # RewriteRule "^/app/register$" "/app/register/index.html"

		# everything else to new frontend
		ProxyPass / http://localhost:8000/
		ProxyPassReverse / http://localhost:8000/

        ServerSignature Off

        ErrorDocument 404 /404.html
</VirtualHost>
